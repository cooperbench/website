<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Leaderboard · CooperBench</title>
    <meta name="description" content="Model performance on CooperBench collaborative coding tasks" />
    <link rel="icon" type="image/svg+xml" href="static/images/favicon.svg?v=2" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nebula Sans', 'system-ui', 'sans-serif'],
                        mono: ['SF Mono', 'Monaco', 'monospace'],
                    },
                },
            },
        };
    </script>
    
    <style>
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-Light.woff2") format("woff2");
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-LightItalic.woff2") format("woff2");
            font-weight: 300;
            font-style: italic;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-Book.woff2") format("woff2");
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-BookItalic.woff2") format("woff2");
            font-weight: 400;
            font-style: italic;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-Medium.woff2") format("woff2");
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-MediumItalic.woff2") format("woff2");
            font-weight: 500;
            font-style: italic;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-Semibold.woff2") format("woff2");
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-SemiboldItalic.woff2") format("woff2");
            font-weight: 600;
            font-style: italic;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-Bold.woff2") format("woff2");
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-BoldItalic.woff2") format("woff2");
            font-weight: 700;
            font-style: italic;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-Black.woff2") format("woff2");
            font-weight: 800;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: "Nebula Sans";
            src: url("static/fonts/NebulaSans-BlackItalic.woff2") format("woff2");
            font-weight: 800;
            font-style: italic;
            font-display: swap;
        }
        body, .font-sans, h1, h2, h3, h4, h5, h6 {
            font-family: "Nebula Sans", system-ui, sans-serif !important;
        }
        
        /* Side panel animation */
        .side-panel { 
            transform: translateX(calc(100% + 1rem)); 
            transition: transform 0.25s ease-out; 
        }
        .side-panel.open { 
            transform: translateX(0); 
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur border-b border-gray-200 z-50">
        <div class="max-w-6xl mx-auto px-6">
            <div class="flex items-center justify-between h-14">
                <a href="index.html" class="flex items-center gap-2 text-lg font-semibold text-gray-900">
                        <img src="static/images/favicon.svg" alt="" class="w-5 h-5" style="filter: brightness(0);">
                        CooperBench
                    </a>
                <nav class="flex items-center gap-6">
                    <a href="leaderboard.html" class="text-sm text-gray-900 font-medium">Leaderboard</a>
                    <a href="tasks.html" class="text-sm text-gray-600 hover:text-gray-900">Tasks</a>
                    <a href="viewer.html" class="text-sm text-gray-600 hover:text-gray-900">Trajectories</a>
                    <a href="blog.html" class="text-sm text-gray-600 hover:text-gray-900">Blog</a>
                    <a href="https://arxiv.org/abs/2601.13295" target="_blank" class="text-sm text-gray-600 hover:text-gray-900">Paper <span class="text-xs">↗</span></a>
                    <a href="https://github.com/cooperbench/CooperBench" target="_blank" class="text-gray-600 hover:text-gray-900"><i class="fab fa-github"></i></a>
                </nav>
            </div>
        </div>
    </header>

    <main class="pt-14">
        <!-- Page Header -->
        <div class="bg-white border-b border-gray-200">
            <div class="max-w-4xl mx-auto px-6 py-8">
                <div class="text-sm text-gray-500 mb-4">
                    <a href="index.html" class="hover:text-gray-700">Home</a>
                    <span class="mx-2">›</span>
                    <span class="text-gray-900">Leaderboard</span>
                </div>
                
                <h1 class="text-2xl font-semibold text-gray-900 mb-2">Leaderboard</h1>
                <p class="text-gray-600">Model performance on 652 collaborative coding tasks</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto px-6 py-8">
            <!-- View Toggle -->
            <div class="flex items-center gap-4 mb-6">
                <button id="btn-coop" onclick="setView('coop')" class="px-3 py-1.5 text-sm font-medium rounded-lg bg-gray-900 text-white">
                    Cooperative
                </button>
                <button id="btn-solo" onclick="setView('solo')" class="px-3 py-1.5 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">
                    Solo
                </button>
            </div>

            <!-- Leaderboard Table -->
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200 bg-gray-50">
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider px-4 py-3">Rank</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider px-4 py-3">Model</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider px-4 py-3 w-1/2">
                                <span id="metric-label">Cooperative Success Rate</span>
                            </th>
                            <th class="text-right text-xs font-medium text-gray-500 uppercase tracking-wider px-4 py-3">Score</th>
                            <th class="w-10"></th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body" class="divide-y divide-gray-100">
                        <!-- Rows will be rendered here -->
                    </tbody>
                </table>
            </div>

            <!-- Legend -->
            <div id="legend" class="mt-4 flex items-center gap-6 text-xs text-gray-500">
                <div class="flex items-center gap-2">
                    <div id="legend-bar" class="w-3 h-3 bg-gray-900 rounded-sm"></div>
                    <span id="legend-label">Cooperative</span>
                </div>
                <div class="flex items-center gap-2">
                    <div id="legend-ci" class="w-8 h-0.5 bg-gray-600"></div>
                    <span>95% CI</span>
                </div>
            </div>

            <!-- Methodology Note -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h3 class="text-sm font-medium text-gray-900 mb-2">Methodology</h3>
                <p class="text-sm text-gray-600 leading-relaxed">
                    <strong>Cooperative:</strong> Two agents work on separate features that may conflict. Success requires both features to pass tests after merging.
                </p>
                <p class="text-sm text-gray-600 leading-relaxed mt-2">
                    <strong>Solo:</strong> A single agent implements both features. This serves as the upper bound for what agents can achieve.
                </p>
                <p class="text-sm text-gray-500 mt-3">
                    All models evaluated on the same 652 tasks with identical prompts and tool access.
                </p>
            </div>

            <!-- Detailed Results -->
            <div class="mt-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Detailed Results</h2>
                
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-200 bg-gray-50">
                                <th class="text-left font-medium text-gray-700 px-4 py-3">Model</th>
                                <th class="text-center font-medium text-gray-700 px-4 py-3">Solo</th>
                                <th class="text-center font-medium text-gray-700 px-4 py-3">Coop</th>
                                <th class="text-center font-medium text-gray-700 px-4 py-3">Gap</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr>
                                <td class="px-4 py-3 font-medium">GPT-5</td>
                                <td class="px-4 py-3 text-center">48.31%</td>
                                <td class="px-4 py-3 text-center">27.95%</td>
                                <td class="px-4 py-3 text-center text-red-600">-20.36%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium">Claude Sonnet 4.5</td>
                                <td class="px-4 py-3 text-center">47.09%</td>
                                <td class="px-4 py-3 text-center">25.92%</td>
                                <td class="px-4 py-3 text-center text-red-600">-21.17%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium">MiniMax M2</td>
                                <td class="px-4 py-3 text-center">36.20%</td>
                                <td class="px-4 py-3 text-center">13.96%</td>
                                <td class="px-4 py-3 text-center text-red-600">-22.24%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium">Qwen3-Coder-30B</td>
                                <td class="px-4 py-3 text-center">21.63%</td>
                                <td class="px-4 py-3 text-center">13.34%</td>
                                <td class="px-4 py-3 text-center text-red-600">-8.29%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 font-medium">Qwen3-30B</td>
                                <td class="px-4 py-3 text-center">6.29%</td>
                                <td class="px-4 py-3 text-center">4.60%</td>
                                <td class="px-4 py-3 text-center text-red-600">-1.69%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-200 bg-white py-8 px-6">
        <div class="max-w-4xl mx-auto text-center text-sm text-gray-500">
            CooperBench · Stanford University & SAP Labs
        </div>
    </footer>

    <!-- Model Detail Panel -->
    <div id="panel-backdrop" class="fixed inset-0 bg-black/30 z-[60] opacity-0 pointer-events-none transition-opacity duration-200" onclick="closeModelPanel()"></div>
    <div id="model-panel" class="side-panel fixed top-4 right-4 bottom-4 w-full max-w-4xl bg-white z-[70] shadow-2xl rounded-xl flex flex-col overflow-hidden">
        <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
            <div>
                <h2 id="panel-model-name" class="text-lg font-semibold text-gray-900">Model Results</h2>
                <p id="panel-model-stats" class="text-sm text-gray-500">0/0 tasks passed</p>
            </div>
            <button onclick="closeModelPanel()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <!-- Filters -->
        <div class="px-6 py-3 border-b border-gray-100 flex items-center gap-4">
            <input type="text" id="panel-search" placeholder="Search tasks..." class="flex-1 px-3 py-1.5 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-gray-400" oninput="filterPanelTasks()">
            <select id="panel-filter-status" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg focus:outline-none" onchange="filterPanelTasks()">
                <option value="">All status</option>
                <option value="passed">Passed only</option>
                <option value="failed">Failed only</option>
            </select>
            <select id="panel-filter-repo" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg focus:outline-none" onchange="filterPanelTasks()">
                <option value="">All repos</option>
            </select>
        </div>
        
        <!-- Task count -->
        <div class="px-6 py-2 text-xs text-gray-500 border-b border-gray-100">
            <span id="panel-task-count">0 tasks</span>
        </div>
        
        <!-- Task Table -->
        <div class="flex-1 overflow-y-auto">
            <table class="w-full text-sm">
                <thead class="sticky top-0 bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="text-left font-medium text-gray-600 px-6 py-2">Repository</th>
                        <th class="text-left font-medium text-gray-600 px-4 py-2">Task</th>
                        <th class="text-left font-medium text-gray-600 px-4 py-2">Features</th>
                        <th class="text-center font-medium text-gray-600 px-4 py-2">Status</th>
                        <th class="text-center font-medium text-gray-600 px-4 py-2">Trajectory</th>
                    </tr>
                </thead>
                <tbody id="panel-tasks-body" class="divide-y divide-gray-100">
                    <!-- Rows rendered here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const leaderboardData = {
            coop: [
                { rank: 1, model: 'GPT-5', modelKey: 'gpt5', fullName: null, score: 27.95, ci: [24.5, 31.3] },
                { rank: 2, model: 'Claude Sonnet 4.5', modelKey: 'claude', fullName: null, score: 25.92, ci: [22.7, 29.4] },
                { rank: 3, model: 'MiniMax M2', modelKey: 'minimax', fullName: null, score: 13.96, ci: [11.5, 16.8] },
                { rank: 4, model: 'Qwen3-Coder-30B', modelKey: 'qwen_coder', fullName: 'Qwen3-Coder-30B-A3B-Instruct', score: 13.34, ci: [10.9, 16.2] },
                { rank: 5, model: 'Qwen3-30B', modelKey: 'qwen', fullName: 'Qwen3-30B-A3B-Instruct-2507', score: 4.60, ci: [3.2, 6.5] },
            ],
            solo: [
                { rank: 1, model: 'GPT-5', modelKey: 'gpt5', fullName: null, score: 48.31, ci: [44.50, 52.15] },
                { rank: 2, model: 'Claude Sonnet 4.5', modelKey: 'claude', fullName: null, score: 47.09, ci: [43.28, 50.92] },
                { rank: 3, model: 'MiniMax M2', modelKey: 'minimax', fullName: null, score: 36.20, ci: [32.60, 39.96] },
                { rank: 4, model: 'Qwen3-Coder-30B', modelKey: 'qwen_coder', fullName: 'Qwen3-Coder-30B-A3B-Instruct', score: 21.63, ci: [18.64, 24.95] },
                { rank: 5, model: 'Qwen3-30B', modelKey: 'qwen', fullName: 'Qwen3-30B-A3B-Instruct-2507', score: 6.29, ci: [4.67, 8.42] },
            ]
        };

        let currentView = 'coop';
        let coopIndex = null;
        let currentModelKey = null;

        // Load coop index on page load
        async function loadCoopIndex() {
            try {
                const response = await fetch('static/data/coop/index.json');
                coopIndex = await response.json();
                populateRepoFilter();
                // Re-render leaderboard to show arrows now that data is loaded
                renderLeaderboard();
            } catch (e) {
                console.error('Error loading coop index:', e);
            }
        }

        function populateRepoFilter() {
            if (!coopIndex) return;
            const repos = [...new Set(coopIndex.tasks.map(t => t.repo))].sort();
            const select = document.getElementById('panel-filter-repo');
            select.innerHTML = '<option value="">All repos</option>';
            repos.forEach(repo => {
                const opt = document.createElement('option');
                opt.value = repo;
                opt.textContent = repo.replace(/_/g, ' ');
                select.appendChild(opt);
            });
        }

        function setView(view) {
            currentView = view;
            document.getElementById('btn-coop').className = view === 'coop' 
                ? 'px-3 py-1.5 text-sm font-medium rounded-lg bg-gray-900 text-white'
                : 'px-3 py-1.5 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200';
            document.getElementById('btn-solo').className = view === 'solo'
                ? 'px-3 py-1.5 text-sm font-medium rounded-lg bg-gray-900 text-white'
                : 'px-3 py-1.5 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200';
            document.getElementById('metric-label').textContent = view === 'coop' 
                ? 'Cooperative Success Rate' 
                : 'Solo Success Rate';
            document.getElementById('legend-bar').className = view === 'coop'
                ? 'w-3 h-3 bg-gray-900 rounded-sm'
                : 'w-3 h-3 bg-blue-500 rounded-sm';
            document.getElementById('legend-ci').className = view === 'coop'
                ? 'w-8 h-0.5 bg-gray-600'
                : 'w-8 h-0.5 bg-blue-400';
            document.getElementById('legend-label').textContent = view === 'coop' ? 'Cooperative' : 'Solo';
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const data = leaderboardData[currentView];
            const maxScore = 100;
            const tbody = document.getElementById('leaderboard-body');
            
            const barColor = currentView === 'coop' ? 'bg-gray-900' : 'bg-blue-500';
            const ciColor = currentView === 'coop' ? 'bg-gray-600' : 'bg-blue-400';
            
            tbody.innerHTML = data.map(item => {
                const barWidth = (item.score / maxScore) * 100;
                const ciLow = (item.ci[0] / maxScore) * 100;
                const ciHigh = (item.ci[1] / maxScore) * 100;
                const clickable = currentView === 'coop' && coopIndex;
                
                return `
                    <tr class="hover:bg-gray-50 ${clickable ? 'cursor-pointer' : ''}" ${clickable ? `onclick="openModelPanel('${item.modelKey}')"` : ''}>
                        <td class="px-4 py-4 text-sm text-gray-500">${item.rank}</td>
                        <td class="px-4 py-4">
                            <span class="font-medium text-gray-900">${item.model}</span>
                            ${item.fullName ? `<div class="text-xs text-gray-400 font-mono">${item.fullName}</div>` : ''}
                        </td>
                        <td class="px-4 py-4">
                            <div class="relative h-5 bg-gray-100 rounded">
                                <div class="absolute inset-y-0 left-0 ${barColor} rounded" style="width: ${barWidth}%"></div>
                                <div class="absolute top-1/2 -translate-y-1/2 h-2.5 flex items-center" style="left: ${ciLow}%; width: ${ciHigh - ciLow}%;">
                                    <div class="w-0.5 h-full ${ciColor}"></div>
                                    <div class="flex-1 h-0.5 ${ciColor}"></div>
                                    <div class="w-0.5 h-full ${ciColor}"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-4 text-right">
                            <span class="font-semibold text-gray-900 tabular-nums">${item.score.toFixed(1)}%</span>
                        </td>
                        <td class="px-4 py-4 text-center">
                            ${clickable ? '<span class="text-gray-400">→</span>' : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openModelPanel(modelKey) {
            if (!coopIndex) return;
            
            currentModelKey = modelKey;
            const modelName = coopIndex.modelDisplayNames[modelKey] || modelKey;
            const stats = coopIndex.stats[modelKey];
            
            document.getElementById('panel-model-name').textContent = `${modelName} Results`;
            document.getElementById('panel-model-stats').textContent = `${stats.passed}/${stats.total} tasks passed (${stats.rate}%)`;
            
            // Reset filters
            document.getElementById('panel-search').value = '';
            document.getElementById('panel-filter-status').value = '';
            document.getElementById('panel-filter-repo').value = '';
            
            renderPanelTasks();
            
            // Show panel
            document.getElementById('panel-backdrop').classList.remove('opacity-0', 'pointer-events-none');
            document.getElementById('model-panel').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeModelPanel() {
            document.getElementById('panel-backdrop').classList.add('opacity-0', 'pointer-events-none');
            document.getElementById('model-panel').classList.remove('open');
            document.body.style.overflow = '';
            currentModelKey = null;
        }

        function filterPanelTasks() {
            renderPanelTasks();
        }

        function renderPanelTasks() {
            if (!coopIndex || !currentModelKey) return;
            
            const search = document.getElementById('panel-search').value.toLowerCase();
            const statusFilter = document.getElementById('panel-filter-status').value;
            const repoFilter = document.getElementById('panel-filter-repo').value;
            
            // Filter tasks that have results for this model
            let tasks = coopIndex.tasks.filter(task => {
                if (!task.results[currentModelKey]) return false;
                
                const result = task.results[currentModelKey];
                
                // Apply filters
                if (statusFilter === 'passed' && !result.passed) return false;
                if (statusFilter === 'failed' && result.passed) return false;
                if (repoFilter && task.repo !== repoFilter) return false;
                if (search) {
                    const searchStr = `${task.repo} ${task.taskId} ${task.features}`.toLowerCase();
                    if (!searchStr.includes(search)) return false;
                }
                
                return true;
            });
            
            document.getElementById('panel-task-count').textContent = `${tasks.length} tasks`;
            
            const tbody = document.getElementById('panel-tasks-body');
            
            if (tasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">No tasks match filters</td></tr>';
                return;
            }
            
            tbody.innerHTML = tasks.map(task => {
                const result = task.results[currentModelKey];
                const hasTrajectory = task.hasTrajectory && task.hasTrajectory[currentModelKey];
                
                const statusBadge = result.passed
                    ? '<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">Pass</span>'
                    : '<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">Fail</span>';
                
                const trajLink = hasTrajectory
                    ? `<a href="viewer.html?model=${currentModelKey}&repo=${task.repo}&task=${task.taskId}&features=${task.features}" class="inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded">View →</a>`
                    : '<span class="text-xs text-gray-400">—</span>';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-3 text-gray-600 font-mono text-xs">${task.repo.replace(/_/g, ' ')}</td>
                        <td class="px-4 py-3 text-gray-900 font-medium">${task.taskId}</td>
                        <td class="px-4 py-3 text-gray-600 text-xs">${task.f1} + ${task.f2}</td>
                        <td class="px-4 py-3 text-center">${statusBadge}</td>
                        <td class="px-4 py-3 text-center">${trajLink}</td>
                    </tr>
                `;
            }).join('');
        }

        // Close panel on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModelPanel();
        });

        // Initial load
        loadCoopIndex();
        renderLeaderboard();
    </script>
</body>
</html>
